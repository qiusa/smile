/** * 上左导航栏模板 */define(['regularjs', 'jquery', '../../javascript/base/util', '../../html/sliderbar/index.html', '../../javascript/widget/tip.js', '../../javascript/widget/dialog.js', '../../javascript/3rd/cookie.js', '../../javascript/base/const.js'], function(Regular, $, util, index, tip, dialog, cookie, api) {    require('../../css/sliderbar.css');    return Regular.extend({        name: 'sliderbarTpl',        template: index,        data: {            //登陆账户信息            user: {                nick: '',                icon: ''            },            pro: {}//外部传入的数据        },        init: function() {            var self = this;            util.rest(api.USER.getAccountInfo, {                param: {},                method: 'post',                onload: function(data) {                    self.data.user.nick = data.email;                    //合并数据                    util.mergeRecursive(self.data.pro, data);                    self.$update();                },                onerror: function() {                    //错误则跳转登陆首页                    window.location.href = './login.html';                }            });            this.initCtrol();        },        /**         * 初始化控件         */        initCtrol: function() {            //提示框            this.tip = util.tip();        },        /**         * 登出         */        loginOut: function() {            var self = this;            //弹出框            var loginOutDialog = new dialog({                data: {                    pro: {                        id: 'loginOutDialog',                        single: false,                        title: '你是否确定要退出？',                        height: 'auto',                        confirmBtnText: '确定',                        confirmCallback: function() {                            util.rest(api.USER.logout, {                                param:{},                                method: 'post',                                onload: function(data) {                                    cookie.remove('token');                                    cookie.remove('uid');                                    window.location.href = './login.html';                                },                                onerror: function() {                                    self.tip.showErrorTip('登出失败，请稍后重试');                                }                            });                            //todo                            //window.location.href = './login.html'                        },                        cancelBtnText: '取消',                        cancelCallback: function() {}                    }                },                template: '<diglogTpl pro={pro}>\                                <p class="u-pdt18"></p>\                            </diglogTpl>'            });            loginOutDialog.$inject('body');        }    });}); 
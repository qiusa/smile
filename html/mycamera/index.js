/** * 我的摄像机页面 */define(['regularjs', 'jquery', '../../javascript/base/util', '../../html/mycamera/index.html', '../../javascript/widget/tip.js', '../../javascript/widget/dialog.js', '../../html/sliderbar/index.js', '../../javascript/widget/pager/pager.js', '../../javascript/base/const.js'], function(Regular, $, util, index, tip, dialog, sliderbar, pager, api) {    require('../../css/mycamera.css');    return Regular.extend({        template: '<sliderbarTpl pro = {user}>' + index + '</sliderbarTpl>',        data: {            //登陆账户密码            user: {                nick: '游客考拉',                icon: '',                type: 2 //左侧导航栏模块标识            },            showParams: {                show: 2,                checkboxAll: false, //是否选中全部                temp: ''//临时变量            },            config: {                total: 0//设备数量            },            dataList: []        },        init: function() {            this.initCtrol();            this.initWatch();            this.initEvent();            this.render();        },        /**         * 初始化控件         * @return {} [description]         */        initCtrol: function() {            //提示框            this.tip = util.tip();        },        initPager: function() {            var self = this;            //分页控件            var pager = Regular.extend({                template: "{total}:{current}\                    <pager total={Math.ceil(total/20)} current={current} on-nav={this.changePage($event)}/>",                changePage: function(page) {                    console.info(self);                    self.renderPage(page);                }            })            pager = new pager({                data: {                    total: self.data.config.total,                    current: 1                }            }).$inject('#pager');        },        /**         * 监听事件         */        initWatch: function() {            this.$watch('showParams.checkboxAll', function(oldValue, newValue) {                if (newValue == undefined) return; //变化值为undefined为无效触发                for (var i = 0; i < this.data.dataList.length; i++) {                    this.data.dataList[i].checkbox = newValue ? false : true;                }            });        },        initEvent: function() {            //下拉框点击事件            $(document).on('click', function(event) {                $('.j-select').removeClass('live');                if ($(event.target).hasClass('j-select')) {                    $(event.target).addClass('live');                }            });        },        renderPage: function(page) {            this.data.pageNumber = page;            this.$update();            console.info(this);        },        render: function() {            var self = this,                param = {                    limit: 10,                    offset: 0                };            util.rest(api.DEVICE.deviceList, {                param: param,                method: 'post',                onload: function(data) {                    console.info('成功');                    //todo                    var data = {result:[{              "deviceId": "163021507028411",              "ownerId": "8318007",              "cameraName": "111",              "snapshot": "https://nos.netease.com/.... ",              "blurSnapshot": "https://nos.netease.com/.... ",              "uploadSwitch": 0,              "status": -1,              "recordPkg": 7            }]}                    self.data.dataList = data.result;                    self.data.config.total = data.total || 0;                    self.$update();                    self.initPager();                    //各类错误todo                },                onerror: function(data) {                    self.tip.showErrorTip(data.message || '加载数据失败，请稍后重试');                }            })        },        /**         * 操作显示列表         */        onShow: function(event) {            Regular.dom.addClass(event.origin, 'live');        },        /**         * 操作隐藏列表         */        onHide: function(event) {            Regular.dom.delClass(event.origin, 'live');        },        /**         * 选中设备         */        check: function(index) {            console.info('index', index)            this.data.dataList[index].checkbox = this.data.dataList[index].checkbox ? false : true;            this.$update();        },        /**         * 编辑设备名称         * @param  {[type]} event [description]         * @param  {Stirng} value 当前设备名称         */        edit: function(event, value) {            console.info(event)            this.data.showParams.temp = value;            this.$update();            event.origin.style.display = 'none';            event.origin.nextElementSibling.style.display = 'block';            event.origin.nextElementSibling.firstElementChild.focus(); //input选中        },        /**         * 隐藏编辑设备名称         * @param  {[type]} event [description]         * @param  {Number} index 当前设备序号         * @param  {Stirng} value 修改的设备名称         */        hide: function(event, index, value) {            if (util.trim(value)) {                var self = this,                    param = {                        deviceId: self.data.dataList[index].deviceId,                        cameraName: value                    };                util.rest(api.DEVICE.setDeviceName, {                    param: param,                    method: 'post',                    onload: function() {                        console.info('成功');                        self.data.dataList[index].cameraName = value;                        self.$update();                        self.tip.showSuccessTip('设置成功');                        event.origin.parentElement.style.display = 'none';                        event.origin.parentElement.previousElementSibling.style.display = 'block';                    },                    onerror: function() {                        self.tip.showErrorTip('设置失败，请稍后再试');                        event.origin.parentElement.style.display = 'none';                        event.origin.parentElement.previousElementSibling.style.display = 'block';                    }                })            }                    },        addPhoneVerify: function(data) {            var addPhoneVerifyDialog = new dialog({                data: {                    pro: {                        id: 'addPhoneVerify',                        single: false,                        singleCenter: true, //一个居中按钮                        title: '添加手机号',                        confirmBtnText: '下一步',                        confirmCallback: function() {                            console.info(this)                            self.addPhoneVerify(this.addPhone);                        },                        cancelBtnText: '取消',                        cancelCallback: function() {},                        isAnimate: true, //是否有动画                        isFull: false, //是否添加溢出 == 5                        addPhone: '', //增加的手机号码                        message: '' //删除的手机号码                    }                },                template: '<diglogTpl pro={pro}>\                                <span>添加手机号</span>\                                <input type="text" r-model={pro.addPhone} />\                                <input type="text" r-model={pro.message}/>\                            </diglogTpl>'            });            addPhoneVerifyDialog.$inject('body');            console.info(this.dialog)        },        modifyDialog: function() {            var self = this;            //弹出框            this.dialog = new dialog({                data: {                    pro: {                        id: 'modifyDialog',                        single: false,                        singleCenter: true, //一个居中按钮                        title: '添加手机号',                        confirmBtnText: '下一步',                        confirmCallback: function() {                            console.info(this)                            this.isAnimate = false;                            self.addPhoneVerify(this.addPhone);                        },                        cancelBtnText: '取消',                        cancelCallback: function() {},                        isAnimate: true, //是否有动画                        isFull: false, //是否添加溢出 == 5                        phoneList: [12312, 22222], //手机号码列表                        addPhone: '', //增加的手机号码                        delPhone: '' //删除的手机号码                    }                },                template: '<diglogTpl pro={pro}>\                                <span>已添加的手机号（最多可添加5个）：</span>\                                {#list pro.phoneList as item}\                                <dl data-index={iten_index}>\                                    <dt>{item}</dt>\                                    <dd on-click={this.delPhone()}>x</dd>\                                </dl>\                                {/list}\                            </diglogTpl>'            });            this.dialog.$inject('body');            console.info(this.dialog)        }    });});
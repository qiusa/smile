define(['regularjs', 'jquery', '../../javascript/base/util', '../../html/resetpwd/index.html', '../../javascript/widget/tip.js', '../../javascript/widget/dialog.js', '../../html/loginnav/index.js'], function(Regular, $, util, index, tip, dialog) {    require('../../css/resetpwd.css')    return Regular.extend({        template: '<loginNav>' + index + '</loginNav>',        data: {            //登陆账户密码            reset: {                account: '',//帐号                verifyCode: ''//图片验证码            },            info: {                verifyImg: '',            },            error: {                accountError: '',//账号错误                verifyError: ''//验证码错误            }        },        init: function() {            console.info(tip, dialog)                //提示框            this.tip = new tip();            this.tip.$inject('body');            this.getVerifyImg();        },        /**         * 获取图片验证码         * @return {[type]} [description]         */        getVerifyImg: function() {            var self = this;            //发送登录请求            util.rest('../getVerifyImg', {                param: 'data',                method: 'post',                onload: function(data) {                    console.info('成功');                    if (data && typeof data != undefined) {                        self.data.info.verifyImg = data;                        self.$update();                    }                },                onerror: function(data) {                    console.info('牺牲');                    self.data.error.verifyError = '获取验证失败，请点击重试';                    self.tip.showError('获取验证失败，请点击重试');                }            })        },        /**         * 下一步按钮点击         */        stepClick: function() {            console.info(888);            var result = this.verify(),                self = this,                data = {};            this.data.error = {                accountError: '',//账号错误                verifyError: ''//验证码错误            }            if (result.error) {                this.tip.showError(result.errmsg);                if (result.type == 1) {                    self.data.error.accountError = result.errmsg;                } else {                    self.data.error.verifyError = result.errmsg;                }                return;            }            if (result.type == 'phone') {                data.mobile = result.account;            } else {                data.email = result.account;            }            data.imagecode = result.code;            console.info('send1', data);            //发送重置密码请求            util.rest('../resetpwd', {                param: data,                method: 'post',                onload: function() {                    console.info('成功');                    if (data && typeof data != undefined) {                        //跳转带参数                        if (result.type == 'email') {                            window.location.href = './resetpwdemail.html?type=email&account=' + self.data.reset.account;                        } else {                            window.location.href = './resetpwdephone.html?type=phone&account=' + self.data.reset.account;                        }                                            }                    //各类错误todo                },                onerror: function() {                    console.info('牺牲');                    //跳转带参数                    if (result.type == 'email') {                        window.location.href = './resetpwdemail.html?type=email&account=error' + self.data.reset.account;                    } else {                        window.location.href = './resetpwdphone.html?type=phone&account=error' + self.data.reset.account;                    }                }            })        },        /**         * 校验账号密码输入         */        verify: function() {            var regPhone = /^1[3578]\d{9}$/, //匹配手机号                regEmail = /^([\w-_]+(?:\.[\w-_]+)*)@((?:[a-z0-9]+(?:-[a-zA-Z0-9]+)*)+\.[a-z]{2,6})$/i; //匹配邮箱;            if (!util.trim(this.data.reset.account)) {                return {                    error: true,                    type: 1,                    errmsg: '请输入注册企业的邮箱地址或手机号码'                }            }            if (!regPhone.test(this.data.reset.account) && !regEmail.test(this.data.reset.account)) {                return {                    error: true,                    type: 1,                    errmsg: '注册企业的邮箱地址或手机号码有误'                }            }            if (!util.trim(this.data.reset.verifyCode)) {                return {                    error: true,                    type: 2,                    errmsg: '请输入图片验证码'                }            }            return {                account: this.data.reset.account,                code: this.data.reset.verifyCode,                type: regPhone.test(this.data.reset.account) ? 'phone' : 'email'            };        }    });});
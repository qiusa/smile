define(['regularjs', 'jquery', '../../javascript/base/util', '../../html/liveaddress/index.html', '../../javascript/3rd/clipboard.js', '../../javascript/widget/tip.js', '../../javascript/widget/dialog.js', '../../html/sliderbar/index.js'], function(Regular, $, util, index, Clipboard, tip, dialog, sliderbar) {    require('../../css/liveaddress.css')    return Regular.extend({        template: '<sliderbarTpl pro = {user}>' + index + '</sliderbarTpl>',        data: {            //登陆账户密码            user: {                nick: '游客考拉',                icon: '',                type: 2 //左侧导航栏模块标识            },            config: {                pwd: '' //播放密码            },            show: {                check: false, //直播设置选中                radioCheck: false //播放密码是否有            }        },        init: function() {            this.initCtrol();        },        /**         * 初始化控件         */        initCtrol: function() {            var self = this;            //提示框            this.tip = new tip();            this.tip.$inject('body');            //复制            var clipboard = new Clipboard('#copyAddress');            clipboard.on('success', function(e) {                self.tip.showTip('复制成功');                e.clearSelection();            });            clipboard.on('error', function(e) {                self.tip.showTip('复制失败');            });            //阻止浏览器默认行。             $('#upload').on({                dragleave: function(e) { //拖离                     e.preventDefault();                },                drop: function(e) { //拖后放                     console.info(9911111)                    e.preventDefault();                    var fileList = e.dataTransfer.files; //获取文件对象                     //检测是否是拖拽文件到页面的操作                     if (fileList.length == 0) {                        return false;                    }                    //检测文件是不是图片                     if (fileList[0].type.indexOf('image') === -1) {                        alert("您拖的不是图片！");                        return false;                    }                    //拖拉图片到浏览器，可以实现预览功能                     var img = window.webkitURL.createObjectURL(fileList[0]);                    var filename = fileList[0].name; //图片名称                     var filesize = Math.floor((fileList[0].size) / 1024);                    if (filesize > 200) {                        alert("上传大小不能超过200K.");                        return false;                    }                    var str = "<img src='" + img + "'><p>图片名称：" + filename + "</p><p>大小：" + filesize + "KB</p>";                    $("#preview").html(str);                    //上传                     xhr = new XMLHttpRequest();                    xhr.open("post", "upload.php", true);                    xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");                    var fd = new FormData();                    fd.append('mypic', fileList[0]);                    xhr.send(fd);                },                dragenter: function(e) { //拖进                     e.preventDefault();                },                dragover: function(e) { //拖来拖去                     e.preventDefault();                }            });return;            /*             * Demo2:拖拽上传             */            // 必须阻止dragenter和dragover事件的默认行为，这样才能触发 drop 事件            function handleFileSelect(evt) {                evt.stopPropagation();                evt.preventDefault();                var files = evt.dataTransfer.files; // 文件对象                // 处理多文件                var output = [];                for (var i = 0, f; f = files[i]; i++) {                    output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',                        f.size, ' bytes, last modified: ',                        f.lastModifiedDate.toLocaleDateString(), '</li>');                }                // 显示文件信息                document.getElementById('list').innerHTML = output.join('');            }            function handleDragOver(evt) {                evt.stopPropagation();                evt.preventDefault();                evt.dataTransfer.dropEffect = 'copy';            }            // Setup the dnd listeners.            var dropZone = document.getElementById('drop_zone');            dropZone.addEventListener('dragover', handleDragOver, false);            dropZone.addEventListener('drop', handleFileSelect, false);        },        upload: function() {            document.getElementById('file').click()        },        /**         * 上传分享图片         */        imgChange: function(event) {            var fd = new FormData(),                self = this;            fd.append('file', event.origin.files[0]);            fd.append('pwd', 'sunshine');            //创建xhr            var xhr = new XMLHttpRequest();            fd.append("acttime",new Date().toString());    //本人喜欢在参数中添加时间戳，防止缓存（--、）            //进度条部分            /*xhr.upload.onprogress = function (evt) {                console.info('evt', evt.loaded)                if (evt.lengthComputable) {                    var percentComplete = Math.round(evt.loaded * 100 / evt.total);                }            };            xhr.open("POST", 'http://127.0.0.1:8180/xy/upload', true);            xhr.send(fd);            xhr.onreadystatechange = function () {                console.info(999)                if (xhr.readyState == 4 && xhr.status == 200) {                    var result = xhr.responseText;                }            }                        return;*/            var xhrOnProgress=function(fun) {                xhrOnProgress.onprogress = fun; //绑定监听                //使用闭包实现监听绑                return function() {                    //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象                    var xhr = $.ajaxSettings.xhr();                    //判断监听函数是否为函数                    if (typeof xhrOnProgress.onprogress !== 'function')                        return xhr;                    //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去                    if (xhrOnProgress.onprogress && xhr.upload) {                        xhr.upload.onprogress = xhrOnProgress.onprogress;                    }                    return xhr;                }            }            $.ajax({                url: './xy/upload',                type: 'POST',                xhr:xhrOnProgress(function(e){                    console.log(9999998,e);                    var percent=e.loaded / e.total;//计算百分比                }),                cache: false,                data: fd,                processData: false,                contentType: false            }).done(function(res) {                console.info('res')            }).fail(function(res) {                console.info('djj')                self.tip.showTip('失败');            });        },        /**         * 清空图片上传         */        picDel: function() {            this.data.generateData.shareData.imgUrl = '';            $('#fileUrl').val('');            this.$update();        },        save: function() {            var reg = /^\d{1,6}$/; //不超过6位的纯数字            if (!reg.test(this.data.config.pwd)) {                this.tip.showTip('请输入不超过6位的纯数字密码');                return;            }        }    });});